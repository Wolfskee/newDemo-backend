// ---------------------------
// Prisma Database Schema
// ---------------------------

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
  moduleFormat = "cjs" 
}

datasource db {
  provider = "postgresql"
}

// ---------------------------
// User Roles Enum
// ---------------------------
enum UserRole {
  ADMIN
  EMPLOYEE
  CUSTOMER
}

// ---------------------------
// Status Enums
// ---------------------------
enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum ItemStatus {
  ACTIVE
  INACTIVE
}

enum EmployeeAvailabilityStatus {
  OPEN
  ASSIGNED
  CANCELLED
}


// ---------------------------
// User
// ---------------------------
model User {
  id              String        @id @default(uuid())
  username        String
  email           String        @unique
  password        String
  role            UserRole      @default(CUSTOMER)
  phone           String?       
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  refreshToken    String?
  profileImageKey String?

  // Relations
  appointmentsAsCustomer  Appointment[] @relation("CustomerAppointments")
  appointmentsAsEmployee  Appointment[] @relation("EmployeeAppointments")
  employeeAvailabilities  EmployeeAvailability[]
}

// ---------------------------
// Appointment
// ---------------------------
model Appointment {
  id          String     @id @default(uuid())
  title       String
  description String?
  date        DateTime    // date + time
  status                  AppointmentStatus @default(PENDING)

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relations
  customerId  String
  employeeId  String?

  customer    User        @relation("CustomerAppointments", fields: [customerId], references: [id])
  employee    User?       @relation("EmployeeAppointments", fields: [employeeId], references: [id])
}

// ---------------------------
// Item (Service / Product / Category Item)
// ---------------------------
model Item {
  id          String      @id @default(uuid())
  name        String
  description String?
  price       Float
  duration    Int?        // in minutes
  category    String
  status                  ItemStatus @default(ACTIVE)
  imageKey    String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model EmployeeAvailability {
  id          String   @id @default(uuid())

  // Date + time range
  date        DateTime   
  startTime   DateTime
  endTime     DateTime

  status      EmployeeAvailabilityStatus @default(OPEN)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  employeeId  String
  employee    User     @relation(fields: [employeeId], references: [id])

  @@unique([employeeId, date])
}
